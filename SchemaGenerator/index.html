<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Schema Generator</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/custom.css">
    <link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
    <script src="js/jquery-3.2.1.slim.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/custom.js"></script>
    <script type="text/javascript">
        $(function () {
            writeResult();
            jQuery(document).on({
                keyup: function(){ writeResult(); },
                change: function(){ writeResult(); },
                click: function(){ writeResult(); }
            }, ".code-fields");
        })
    </script>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">Schema Generator</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav">
            <a class="nav-item nav-link active" href="#">Home <span class="sr-only">(current)</span></a>
            <a class="nav-item nav-link" href="#">Features</a>
            <a class="nav-item nav-link" href="#">Pricing</a>
        </div>
    </div>
</nav>
<div class="container" style="margin-top: 20px">
    <div class="row">
        <div id="search-div" class="col-7">
            <div class="panel panel-default">
                <div class="panel-heading" style="padding: 10px">
                    Search Place
                </div>
                <div class="panel-body]]]" style="padding: 20px">
                    <div class="form-group">
                        <input class="form-control" id="autocomplete" placeholder="Enter Place" onFocus="geolocate()" type="text"/>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="addNewFieldModal" tabindex="-1" role="dialog" aria-labelledby="addNewFieldModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Add Field</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="fieldName">Field Name</label>
                        <input type="text" name="fieldName" id="fieldName" class="form-control"/>
                    </div>
                    <button onclick="createNewField()" type="button" class="btn btn-primary">Create</button>
                </div>
            </div>
        </div>
    </div>
    <div class="row container-custom" style="margin-top: 10px">
        <div class="panel panel-default col-7" id="field-list">
            <div class="panel-heading" style="padding: 10px">
                <h5 style="display: inline-block">Fields</h5>
                <button onclick="clearAllData()" type="button" class="btn btn-sm btn-danger field-button">Reset</button>
                <button data-toggle="modal" data-target="#addNewFieldModal" class="btn btn-sm btn-primary field-button">Add New Field</button>
            </div>
            <div class="panel-body field-div" style="padding: 20px">
                <div class="row">
                    <div class="form-group col-6">
                        <label for="type">Type</label>
                        <input name="type" id="type" class="form-control code-fields"/>
                    </div>
                    <div class="form-group col-6">
                        <label for="name">Name</label>
                        <input name="name" id="name" class="form-control code-fields"/>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-12">
                        <label for="description">Description</label>
                        <textarea name="description" rows="5" id="description" class="form-control code-fields"></textarea>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-6">
                        <label for="url">URL</label>
                        <input name="url" id="url" class="form-control code-fields"/>
                    </div>
                    <div class="form-group col-6">
                        <label for="pricerange">Price Range</label>
                        <input name="pricerange" id="pricerange" class="form-control  code-fields"/>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-6">
                        <label for="telephone">Telephone</label>
                        <input name="telephone" id="telephone" class="form-control code-fields"/>
                    </div>
                    <div class="form-group col-6">
                        <label for="image">Image</label>
                        <input name="image" id="image" class="form-control code-fields"/>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading"><b>Address</b></div>
                    <div class="panel-body" style="padding: 20px">
                        <div class="row">
                            <div class="form-group col-6">
                                <label for="addressLocality">Address Locality</label>
                                <input name="addressLocality" id="addressLocality" class="form-control code-fields"/>
                            </div>
                            <div class="form-group col-6">
                                <label for="addressRegion">Address Region</label>
                                <input name="addressRegion" id="addressRegion" class="form-control code-fields"/>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-6">
                                <label for="postalCode">Postal Code</label>
                                <input name="postalCode" id="postalCode" class="form-control code-fields"/>
                            </div>
                            <div class="form-group col-6">
                                <label for="streetAddress">Street Address</label>
                                <input name="streetAddress" id="streetAddress" class="form-control code-fields"/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading"><b>Geo</b></div>
                    <div class="panel-body" style="padding: 20px">
                        <div class="row">
                            <div class="form-group col-6">
                                <label for="latitude">Latitude</label>
                                <input name="latitude" id="latitude" class="form-control code-fields"/>
                            </div>
                            <div class="form-group  col-6">
                                <label for="longitude">Longitude</label>
                                <input name="longitude" id="longitude" class="form-control code-fields"/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="openingHours">Opening Hours</label>
                    <textarea placeholder="Enter multiple days in different lines                                                                  Monday: 9:00 AM – 5:30 PM
Tuesday: 9:00 AM – 5:30 PM"
                              name="openingHours" id="openingHours" rows="5" class="form-control code-fields"></textarea>
                </div>
                <div class="form-group">
                    <label for="sameAs">Same As</label>
                    <textarea placeholder="Enter multiple urls in different lines
https://www.facebook.com/familybracescalgary/
https://twitter.com/family_braces" name="sameAs" id="sameAs" rows="5" class="form-control code-fields"></textarea>
                </div>
                <div class="form-group">
                    <label for="hasMap">Google MAP URL</label>
                    <input name="hasMap" id="hasMap" class="form-control code-fields"/>
                </div>
            </div>
        </div>
        <div class="col-5 code-div-parent">
            <div class="panel panel-default">
                <div class="panel-heading" style="padding: 10px">
                    <h5 style="display: inline-block">Code</h5>
                    <button data-toggle="tooltip" data-placement="right" title="Copy to Clipboard" class="btn btn-sm my-tool-tip" onclick="copyToClipBoard()">Copy Result</button>
                </div>
                <div class="panel-body" style="padding: 15px">
                    <textarea class="code-div" id="schema-code">

                    </textarea>
                </div>
            </div>

        </div>
    </div>
    <div id="map" style="visibility: hidden"></div>
</div>
<script>
    var autocomplete;

    var componentForm = {
        subpremise: "short_name",
        street_number: 'short_name',
        route: 'long_name',
        locality: 'long_name',
        administrative_area_level_1: 'short_name',
        country: 'long_name',
        postal_code: 'short_name'
    };

    function initAutocomplete() {
        // Create the autocomplete object, restricting the search predictions to
        // geographical location types.
        autocomplete = new google.maps.places.Autocomplete(
            document.getElementById('autocomplete'));

        // Avoid paying for data that you don't need by restricting the set of
        // place fields that are returned to just the address components.
        // autocomplete.setFields(['address_component']);

        // When the user selects an address from the drop-down, populate the
        // address fields in the form.
        autocomplete.addListener('place_changed', fillInAddress);
    }

    function writeToField(id, value) {
        if(value && value !== ""){
            if($("#"+id)){
                try{
                    $("#"+id).val(value.replace(/undefined/g,""));
                }catch (e) {
                    $("#"+id).val(value);
                }
            }
        }
    }

    function fillInAddress() {
        // Get the place details from the autocomplete object.
        var place = autocomplete.getPlace();
        try{
            writeToField("name", place.name);
            // Get each component of the address from the place details,
            // and then fill-in the corresponding field on the form.
            let addressData = {};
            for (var i = 0; i < place.address_components.length; i++) {
                var addressType = place.address_components[i].types[0];
                if (componentForm[addressType]) {
                    var val = place.address_components[i][componentForm[addressType]];
                    addressData[addressType] = val;
                }
            }
            writeToField("addressLocality",  addressData["locality"]);
            writeToField("addressRegion",  addressData["administrative_area_level_1"]);
            writeToField("postalCode",  addressData["postal_code"]);
            writeToField("streetAddress",  addressData["street_number"] +" "+ addressData["route"]+ " "+addressData["subpremise"]);
            writeToField("type",  place.types[0]);
            writeToField("telephone",  place.international_phone_number);
            writeToField("url",  place.website);
            let photos = place.photos;
            if(photos){
                writeToField("image",  photos[0].getUrl());
            }
            writeToField("latitude",  place.geometry.location.lat());
            writeToField("longitude",  place.geometry.location.lng());
            writeToField("hasMap",  place.url);
            let openingHours = place.opening_hours;
            if(openingHours){
                openingHours = openingHours.weekday_text;
                let openingHoursText = openingHours.filter(function(el) {
                    return el.indexOf("Closed") === -1;
                }).join('\n');
                writeToField("openingHours",  openingHoursText);
            }
        }catch (e) {

        }
        $("#name").click();

    }

    // Bias the autocomplete object to the user's geographical location,
    // as supplied by the browser's 'navigator.geolocation' object.
    function geolocate() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var geolocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                var circle = new google.maps.Circle(
                    {center: geolocation, radius: position.coords.accuracy});
                autocomplete.setBounds(circle.getBounds());
            });
        }
    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDWTXjSWGG0eHUsTv5QYQbKGeDtqqlblv4&v=3.exp&sensor=false&libraries=places&callback=initAutocomplete"
        async defer></script>
</body>
</html>